<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIS æ‚¬ä¸æ–­è£‚æ¨¡æ‹Ÿå™¨ (Impact Version)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
        }

        /* === è¡—é“èƒŒæ™¯ === */
        .camera-view {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #0f172a 0%, #1e293b 40%, #334155 40%, #0f172a 100%);
            position: relative;
            overflow: hidden;
            transition: transform 0.05s linear, filter 0.1s ease;
            transform-origin: center center;
        }

        .street-light {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(254,240,138,0.8) 0%, rgba(254,240,138,0) 70%);
            border-radius: 50%;
            top: 35%;
        }

        .car-light {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
            bottom: 20%;
            width: 100%;
            opacity: 0.7;
        }
        
        .phone-frame {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 12px solid #1f2937;
            border-radius: 2rem;
            overflow: hidden;
            position: relative;
            background: #000;
        }

        /* OIS ç»“æ„ç¤ºæ„å›¾æ ·å¼ */
        .ois-diagram {
            width: 100%;
            height: 200px;
            background: #1e293b; 
            border-radius: 0.75rem;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lens-assembly {
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #60a5fa, #2563eb);
            border-radius: 50%;
            border: 4px solid #93c5fd;
            position: absolute;
            z-index: 10;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .spring-line {
            position: absolute;
            height: 3px;
            background-color: #94a3b8;
            transform-origin: 0 50%;
            pointer-events: none;
        }

        .anchor-dot {
            position: absolute;
            width: 14px;
            height: 14px;
            background-color: #64748b; 
            border-radius: 50%;
            z-index: 20;
            transform: translate(-50%, -50%);
        }

        canvas {
            background-color: #111;
            border-radius: 0.5rem;
            width: 100%;
            height: 90px;
        }
        
        /* çŠ¶æ€æŒ‰é’®æ ·å¼ */
        .btn-active {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
            color: #1d4ed8 !important;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-solution-active {
            border-color: #8b5cf6 !important;
            background-color: #f5f3ff !important;
            color: #6d28d9 !important;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-road-active {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-handheld-active {
             border-color: #f59e0b !important; /* Amber */
             background-color: #fef3c7 !important;
             color: #b45309 !important;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 md:p-8 min-h-screen">

    <!-- ä¸»å®¹å™¨ -->
    <div class="flex flex-col md:flex-row items-start justify-center gap-8 w-full max-w-6xl mx-auto">

        <!-- å·¦ä¾§ï¼šæ§åˆ¶é¢æ¿ -->
        <div class="w-full md:w-[480px] bg-white p-6 rounded-2xl shadow-xl space-y-6 h-fit max-h-[95vh] overflow-y-auto flex flex-col sticky top-4">
            <div class="flex-shrink-0 border-b border-gray-100 pb-4">
                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                    <span class="text-3xl">ğŸ”¬</span> å·¥ç¨‹é€è§†æ¨¡å¼
                </h1>
                <p class="text-gray-500 text-sm mt-2 font-medium">
                    Engineering View: Structure & Vibration Impact
                </p>
            </div>

            <!-- 1. OIS å†…éƒ¨ç»“æ„é€è§†å›¾ -->
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex-shrink-0 relative">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-xs font-bold text-slate-700 uppercase tracking-wider">Internal Structure (å†…éƒ¨ç»“æ„)</span>
                    <span id="spring-status-text" class="text-xs px-3 py-1 rounded-md bg-green-100 text-green-700 font-bold font-mono">Ready</span>
                </div>
                
                <div class="ois-diagram" id="ois-diagram">
                    <div id="anchor-0" class="anchor-dot"></div>
                    <div id="anchor-1" class="anchor-dot"></div>
                    <div id="anchor-2" class="anchor-dot"></div>
                    <div id="anchor-3" class="anchor-dot"></div>

                    <div id="line-0" class="spring-line"></div>
                    <div id="line-1" class="spring-line"></div>
                    <div id="line-2" class="spring-line"></div>
                    <div id="line-3" class="spring-line"></div>

                    <div id="lens" class="lens-assembly flex items-center justify-center">
                        <div class="w-8 h-8 rounded-full border border-blue-200 opacity-50"></div>
                    </div>
                </div>
                <!-- è¯´æ˜æ–‡å­—æ›´æ–° -->
                <p id="structure-desc" class="text-sm text-slate-500 mt-3 text-center leading-relaxed transition-all font-medium">
                    <!-- Text updated dynamically via JS -->
                </p>
            </div>

            <!-- 2. æ§åˆ¶åŒºåŸŸ -->
            <div class="space-y-5 flex-grow">
                <!-- ç¡¬ä»¶å¼€å…³ -->
                <div class="grid grid-cols-3 gap-3 bg-gray-50 p-2 rounded-xl border border-gray-100">
                    <button onclick="setHardware('normal')" id="btn-normal" class="py-3 text-sm rounded-lg font-semibold text-gray-500 transition-all hover:bg-white leading-snug">
                        æ ‡å‡†å››çº¿ (æ–°)<br><span class="text-[10px] scale-90 block opacity-80 font-normal">Standard (New)</span>
                    </button>
                    <button onclick="setHardware('broken')" id="btn-broken" class="py-3 text-sm rounded-lg font-semibold text-gray-500 transition-all hover:bg-white hover:text-red-500 leading-snug">
                        æ ‡å‡†å››çº¿ (æ—§)<br><span class="text-[10px] scale-90 block opacity-80 font-normal">Standard (Aged)</span>
                    </button>
                    <button onclick="setHardware('solution')" id="btn-solution" class="py-3 text-sm rounded-lg font-bold text-gray-500 transition-all hover:bg-white hover:text-purple-600 leading-snug border border-transparent">
                        âœ¨ ç»ˆææ–¹æ¡ˆ<br><span class="text-[10px] scale-90 block opacity-80 font-normal">Triangular (3-wire)</span>
                    </button>
                </div>

                <!-- è·¯å†µæŒ‰é’® -->
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="setRoad('handheld')" id="road-handheld" class="road-btn flex flex-col items-center justify-center p-4 rounded-xl border border-gray-200 hover:bg-gray-50 transition-all cursor-pointer col-span-2">
                        <span class="text-2xl mb-1">âœ‹ğŸ“±</span>
                        <div class="text-sm font-bold leading-tight text-center">é™æ­¢æ‰‹æŒæ£€æµ‹<br><span class="font-normal text-[10px] block text-gray-400 mt-1">Handheld Check (Office)</span></div>
                    </button>

                    <button onclick="setRoad('gravel')" id="road-gravel" class="road-btn flex flex-col items-center justify-center p-4 rounded-xl border border-gray-200 hover:bg-gray-50 transition-all cursor-pointer">
                        <span class="text-2xl mb-1">ğŸª¨</span>
                        <div class="text-sm font-bold leading-tight text-center">ç¢çŸ³è·¯<br><span class="font-normal text-[10px] block text-gray-400 mt-1">Gravel Road</span></div>
                    </button>
                    <button onclick="setRoad('brick')" id="road-brick" class="road-btn flex flex-col items-center justify-center p-4 rounded-xl border border-gray-200 hover:bg-gray-50 transition-all cursor-pointer">
                        <span class="text-2xl mb-1">ğŸ§±</span>
                        <div class="text-sm font-bold leading-tight text-center text-red-600">æ¯”åˆ©æ—¶è·¯<br><span class="font-normal text-[10px] block text-gray-400 mt-1">Cobblestone (Heavy)</span></div>
                    </button>
                </div>

                <!-- æ•°æ®ç›‘æ§ -->
                <div class="bg-black p-4 rounded-xl border border-gray-800 shadow-inner">
                    <div class="flex justify-between items-end mb-2">
                        <!-- å»æ‰ Resonance å­—çœ¼ï¼Œæ”¹ä¸º Vibration Level -->
                        <span class="text-[10px] font-bold text-gray-400 tracking-wider">VIBRATION LEVEL (éœ‡åŠ¨å¼ºåº¦)</span>
                        <span id="vib-level" class="text-base font-mono text-green-400 font-bold">NORMAL</span>
                    </div>
                    <canvas id="scope" height="60"></canvas>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ‰‹æœºæ¨¡æ‹Ÿå±•ç¤º -->
        <div class="relative w-[340px] h-[680px] phone-frame shadow-2xl flex-shrink-0 transform transition-transform duration-500 mx-auto md:mx-0" id="phone-container">
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-7 bg-black z-20 rounded-b-xl"></div>
            
            <div class="relative w-full h-full bg-black overflow-hidden rounded-[1.5rem]">
                <!-- æ¨¡æ‹Ÿæ‘„åƒå¤´ç”»é¢ -->
                <div id="camera-view" class="camera-view">
                    <div id="office-bg" class="absolute inset-0 bg-gray-200 hidden" style="background-image: url('https://images.unsplash.com/photo-1497215728101-856f4ea42174?q=80&w=1000&auto=format&fit=crop'); background-size: cover; filter: brightness(0.8);"></div>
                    <div id="street-bg" class="absolute inset-0">
                        <div class="street-light" style="left: 20%; top: 35%;"></div>
                        <div class="street-light" style="left: 80%; top: 35%;"></div>
                        <div class="car-light" style="bottom: 20%;"></div>
                        <div class="absolute bottom-0 w-full h-1/3 bg-slate-800 opacity-50"></div>
                    </div>

                    <!-- å¯¹ç„¦æ¡† -->
                    <div id="focus-box" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-24 h-24 border-[3px] border-yellow-400 opacity-80 transition-all duration-75">
                        <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1.5 h-3 bg-yellow-400"></div>
                        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-1.5 h-3 bg-yellow-400"></div>
                        <div class="absolute left-0 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-1.5 bg-yellow-400"></div>
                        <div class="absolute right-0 top-1/2 translate-x-1/2 -translate-y-1/2 w-3 h-1.5 bg-yellow-400"></div>
                    </div>
                </div>

                <!-- UI -->
                <div class="absolute bottom-8 left-0 w-full flex justify-center items-center gap-10 z-10">
                     <div class="w-12 h-12 rounded-lg bg-gray-800 opacity-60 backdrop-blur-sm border border-white/10"></div>
                     <div class="w-20 h-20 rounded-full border-[5px] border-white flex items-center justify-center shadow-lg">
                        <div class="w-16 h-16 rounded-full bg-red-600 opacity-90"></div>
                     </div>
                     <div class="w-12 h-12 rounded-lg bg-gray-800 opacity-60 backdrop-blur-sm border border-white/10"></div>
                </div>
                
                <!-- è­¦å‘Šå¼¹çª— (Updated) -->
                <div id="warning-msg" class="hidden absolute top-20 left-1/2 transform -translate-x-1/2 bg-black/90 backdrop-blur-md px-6 py-4 rounded-xl text-center border border-red-500/50 w-4/5 shadow-2xl z-30">
                    <div class="text-red-500 font-bold text-lg animate-pulse tracking-wide">âš  WIRE SNAPPED</div>
                    <div class="text-white text-sm mt-1 font-medium">æ‚¬ä¸æ–­è£‚ / High Impact</div>
                </div>
                
                <!-- æ‰‹æŒæ£€æµ‹æ•…éšœå¼¹çª— (Bilingual) -->
                 <div id="handheld-fail-msg" class="hidden absolute top-20 left-1/2 transform -translate-x-1/2 bg-yellow-900/90 backdrop-blur-md px-4 py-3 rounded-xl text-center border border-yellow-500/50 w-4/5 shadow-2xl z-30">
                    <div class="text-yellow-400 font-bold text-base tracking-wide">âš  UNABLE TO FOCUS (æ— æ³•å¯¹ç„¦)</div>
                    <div class="text-white text-xs mt-1 font-medium">Wire Loose / æ‚¬ä¸æ¾åŠ¨å¤±æ•ˆ</div>
                </div>

                <!-- æˆåŠŸå¼¹çª— (Bilingual) -->
                 <div id="success-msg" class="hidden absolute top-20 left-1/2 transform -translate-x-1/2 bg-green-900/90 backdrop-blur-md px-6 py-4 rounded-xl text-center border border-green-500/50 w-4/5 shadow-2xl z-30">
                    <div class="text-green-400 font-bold text-lg tracking-wide">âœ… STABLE (ç¨³å®š)</div>
                    <div class="text-white text-sm mt-1 font-medium">Focus Locked / ç”»é¢é”å®š</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // State
        let hardwareState = 'normal'; 
        let roadType = 'handheld'; 
        
        // Configuration
        const CONFIG = {
            handheld: { baseShake: 0.1, failure: false, jitter: true }, 
            gravel: { baseShake: 3.0, failure: false, jitter: false },
            brick:  { baseShake: 5.0, failure: true, jitter: false } // Increased shake, Removed specific freq
        };

        // Elements
        const cameraView = document.getElementById('camera-view');
        const focusBox = document.getElementById('focus-box');
        const warningMsg = document.getElementById('warning-msg');
        const handheldFailMsg = document.getElementById('handheld-fail-msg');
        const successMsg = document.getElementById('success-msg');
        const vibDisplay = document.getElementById('vib-level');
        const springStatusText = document.getElementById('spring-status-text');
        const structureDesc = document.getElementById('structure-desc');
        const officeBg = document.getElementById('office-bg');
        const streetBg = document.getElementById('street-bg');
        
        // Anchors & Lines
        const anchors = [
            document.getElementById('anchor-0'),
            document.getElementById('anchor-1'),
            document.getElementById('anchor-2'),
            document.getElementById('anchor-3')
        ];
        
        const lines = [
            document.getElementById('line-0'),
            document.getElementById('line-1'),
            document.getElementById('line-2'),
            document.getElementById('line-3')
        ];
        
        const lens = document.getElementById('lens');
        const diagramBox = document.getElementById('ois-diagram');

        // Scope
        const canvas = document.getElementById('scope');
        const ctx = canvas.getContext('2d');
        const scopeData = new Array(40).fill(0);

        function setHardware(state) {
            hardwareState = state;
            updateUI();
            updateStructureVisuals();
        }

        function setRoad(type) {
            roadType = type;
            updateUI();
        }

        function updateUI() {
            // Reset Buttons
            document.getElementById('btn-normal').className = "py-3 text-sm rounded-lg font-semibold text-gray-500 transition-all hover:bg-white leading-snug";
            document.getElementById('btn-broken').className = "py-3 text-sm rounded-lg font-semibold text-gray-500 transition-all hover:bg-white hover:text-red-500 leading-snug";
            document.getElementById('btn-solution').className = "py-3 text-sm rounded-lg font-bold text-gray-500 transition-all hover:bg-white hover:text-purple-600 leading-snug border border-transparent";

            // Active Hardware State
            if(hardwareState === 'normal') {
                document.getElementById('btn-normal').classList.add('btn-active');
            } else if (hardwareState === 'broken') {
                document.getElementById('btn-broken').classList.add('border-red-200', 'bg-red-50', 'text-red-600', 'shadow-sm');
                document.getElementById('btn-broken').classList.remove('text-gray-500');
            } else if (hardwareState === 'solution') {
                document.getElementById('btn-solution').classList.add('btn-solution-active');
            }

            // Reset Road Buttons
            document.querySelectorAll('.road-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'ring-1', 'ring-blue-200', 'btn-road-active', 'btn-handheld-active');
                btn.classList.add('border-gray-200', 'bg-white');
            });
            
            const activeBtn = document.getElementById(`road-${roadType}`);
            activeBtn.classList.remove('border-gray-200', 'bg-white');
            
            if (roadType === 'handheld') {
                 activeBtn.classList.add('btn-handheld-active', 'ring-1', 'ring-yellow-200');
                 officeBg.classList.remove('hidden');
                 streetBg.classList.add('hidden');
            } else {
                 activeBtn.classList.add('btn-road-active', 'ring-1', 'ring-blue-200', 'bg-blue-50');
                 officeBg.classList.add('hidden');
                 streetBg.classList.remove('hidden');
            }
        }
        
        function updateStructureVisuals() {
            if (hardwareState === 'solution') {
                setAnchorPos(0, '50%', '15%');
                setAnchorPos(1, '50%', '15%');
                setAnchorPos(2, '15%', '85%');
                setAnchorPos(3, '85%', '85%');
                // Updated description for Triangle (Bilingual)
                structureDesc.innerHTML = `<span class="text-purple-600 font-bold">å…¨æ–°ä¸‰è§’æ‚¬ä¸ç»“æ„ / Triangular Structure</span><br><span class="text-xs">Optimized for ID. ä¸‰ç‚¹ç¨³å›ºï¼Œæ¶ˆé™¤å¾®é¢¤ä¸å…±æŒ¯</span>`;
                springStatusText.innerText = "ä¼˜åŒ–ç»“æ„ / Optimized";
            } else if (hardwareState === 'normal') {
                setAnchorPos(0, '10%', '10%');
                setAnchorPos(1, '90%', '10%');
                setAnchorPos(2, '10%', '90%');
                setAnchorPos(3, '90%', '90%');
                // Updated description for Normal (Bilingual)
                structureDesc.innerHTML = `<span class="text-green-600 font-bold">æ ‡å‡†å››çº¿ç»“æ„ (å‡ºå‚) / Standard 4-Wire (New)</span><br><span class="text-xs">Global Standard. å¼ åŠ›è¶³ï¼Œå…¶ä»–åœ°åŒºè¡¨ç°ä¼˜å¼‚</span>`;
                springStatusText.innerText = "æ‚¬ä¸æ­£å¸¸ / Springs OK";
            } else {
                setAnchorPos(0, '10%', '10%');
                setAnchorPos(1, '90%', '10%');
                setAnchorPos(2, '10%', '90%');
                setAnchorPos(3, '90%', '90%');
                // Updated description for Broken (Bilingual)
                structureDesc.innerHTML = `<span class="text-red-500 font-bold">æ ‡å‡†å››çº¿ç»“æ„ (è€åŒ–) / Standard 4-Wire (Fatigued)</span><br><span class="text-xs">Aged by Vibration. å› é•¿æœŸé¢ ç°¸å¯¼è‡´é‡‘å±ç–²åŠ³</span>`;
                springStatusText.innerText = "æ‚¬ä¸ç–²åŠ³ / Fatigued";
            }
        }

        function setAnchorPos(index, left, top) {
            const anchor = anchors[index];
            if (anchor) {
                anchor.style.left = left;
                anchor.style.top = top;
            }
        }

        function updateLines(lensX, lensY) {
            const boxRect = diagramBox.getBoundingClientRect();
            const centerX = (boxRect.width / 2) + lensX;
            const centerY = (boxRect.height / 2) + lensY;
            
            let corners = [];
            
            if (hardwareState === 'solution') {
                const topX = boxRect.width * 0.5;
                const topY = boxRect.height * 0.15;
                const blX = boxRect.width * 0.15;
                const blY = boxRect.height * 0.85;
                const brX = boxRect.width * 0.85;
                const brY = boxRect.height * 0.85;

                corners = [
                    { x: topX, y: topY }, { x: topX, y: topY },
                    { x: blX, y: blY }, { x: brX, y: brY }
                ];
            } else {
                corners = [
                    { x: boxRect.width * 0.1, y: boxRect.height * 0.1 },
                    { x: boxRect.width * 0.9, y: boxRect.height * 0.1 },
                    { x: boxRect.width * 0.1, y: boxRect.height * 0.9 },
                    { x: boxRect.width * 0.9, y: boxRect.height * 0.9 }
                ];
            }

            corners.forEach((c, idx) => {
                const el = lines[idx];
                if(!el) return;

                const dx = centerX - c.x;
                const dy = centerY - c.y;
                const length = Math.sqrt(dx*dx + dy*dy) - 32; 
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                el.style.width = `${Math.max(0, length)}px`;
                el.style.top = `${c.y}px`;
                el.style.left = `${c.x}px`;
                el.style.transform = `rotate(${angle}deg)`;
                
                if (hardwareState === 'broken' && (roadType === 'brick' || (roadType === 'handheld' && idx === 1))) {
                    el.style.backgroundColor = '#ef4444'; 
                    el.style.height = '4px'; 
                    el.style.zIndex = '50';
                } else if (hardwareState === 'solution') {
                     el.style.backgroundColor = '#8b5cf6';
                     el.style.height = '3px';
                } else {
                    el.style.backgroundColor = '#94a3b8';
                    el.style.height = '3px';
                    el.style.zIndex = 'auto';
                }
            });
        }

        // Animation Loop
        let time = 0;
        function animate() {
            time += 0.1;
            const config = CONFIG[roadType];
            
            let lensX = 0, lensY = 0; 
            let camX = 0, camY = 0;   
            let isFailed = false;
            let isJittering = false;
            let isStableTriangle = (hardwareState === 'solution');

            const baseVib = (Math.random() - 0.5) * config.baseShake;

            if (hardwareState === 'normal') {
                lensX = baseVib * 2; lensY = baseVib * 2;
                camX = baseVib * 0.5; camY = baseVib * 0.5;
                focusBox.style.borderColor = "#facc15";
            } else if (hardwareState === 'broken') {
                if (config.failure) {
                    // Brick Road Failure (Pure Mechanical Impact)
                    isFailed = true;
                    // Violent shake
                    const wave = Math.sin(time * 5) * 15; 
                    const rand = (Math.random() - 0.5) * 10;
                    lensX = wave + rand;
                    lensY = (Math.cos(time * 5.5) * 12) + rand;
                    camX = lensX * 1.5; camY = lensY * 1.5;
                    springStatusText.innerText = "âš ï¸ FATIGUED / ä¸¥é‡ç–²åŠ³";
                    springStatusText.className = "text-xs px-3 py-1 rounded-md bg-red-100 text-red-700 font-bold font-mono animate-pulse";
                    focusBox.style.borderColor = "#ef4444";
                } else if (config.jitter) {
                    isJittering = true;
                    const jitterX = (Math.random() - 0.5) * 3; 
                    const jitterY = (Math.random() - 0.5) * 3;
                    lensX = jitterX; lensY = jitterY;
                    camX = jitterX * 2; camY = jitterY * 2;
                    springStatusText.innerText = "âš ï¸ LOOSE / æ‚¬ä¸æ¾åŠ¨";
                    springStatusText.className = "text-xs px-3 py-1 rounded-md bg-yellow-100 text-yellow-700 font-bold font-mono";
                    focusBox.style.borderColor = "#facc15";
                } else {
                    lensX = baseVib * 4; lensY = baseVib * 4;
                    camX = baseVib * 1.5; camY = baseVib * 1.5;
                    springStatusText.innerText = "âš ï¸ LOOSE / æ‚¬ä¸æ¾åŠ¨";
                    springStatusText.className = "text-xs px-3 py-1 rounded-md bg-yellow-100 text-yellow-700 font-bold font-mono";
                    focusBox.style.borderColor = "#facc15";
                }
            } else if (hardwareState === 'solution') {
                lensX = baseVib * 0.8;
                lensY = baseVib * 0.8;
                camX = baseVib * 0.2; 
                camY = baseVib * 0.2;
                springStatusText.className = "text-xs px-3 py-1 rounded-md bg-purple-100 text-purple-700 font-bold font-mono";
                focusBox.style.borderColor = "#4ade80"; 
            }

            cameraView.style.transform = `translate(${camX}px, ${camY}px) scale(1.1)`;
            
            if (isFailed) {
                 cameraView.style.filter = `blur(4px)`;
            } else if (isJittering) {
                 cameraView.style.filter = `blur(${Math.random() * 2}px)`;
            } else {
                 cameraView.style.filter = `blur(0px)`;
            }
            
            lens.style.transform = `translate(${lensX}px, ${lensY}px)`;
            updateLines(lensX, lensY);

            warningMsg.className = "hidden";
            handheldFailMsg.className = "hidden";
            successMsg.className = "hidden";

            if (isFailed) {
                warningMsg.className = "absolute top-20 left-1/2 transform -translate-x-1/2 bg-black/90 backdrop-blur-md px-6 py-4 rounded-xl text-center border border-red-500/50 w-4/5 shadow-2xl z-30 block";
            } else if (isJittering) {
                handheldFailMsg.className = "absolute top-20 left-1/2 transform -translate-x-1/2 bg-yellow-900/90 backdrop-blur-md px-4 py-3 rounded-xl text-center border border-yellow-500/50 w-4/5 shadow-2xl z-30 block";
            } else if (isStableTriangle && (roadType === 'brick' || roadType === 'handheld')) {
                successMsg.className = "absolute top-20 left-1/2 transform -translate-x-1/2 bg-green-900/90 backdrop-blur-md px-6 py-4 rounded-xl text-center border border-green-500/50 w-4/5 shadow-2xl z-30 block";
            }
            
            if (isFailed || isJittering) {
                const size = 96 + Math.sin(time * 10) * 5;
                focusBox.style.width = size + 'px';
                focusBox.style.height = size + 'px';
                focusBox.style.borderColor = isFailed ? "#ef4444" : "#facc15";
            } else {
                focusBox.style.width = '96px';
                focusBox.style.height = '96px';
                focusBox.style.borderColor = isStableTriangle ? "#4ade80" : "#facc15";
            }
            
            // Scope Text (Bilingual)
            if (isFailed) {
                 vibDisplay.innerText = "âš  WIRE SNAPPED / æ‚¬ä¸æ–­è£‚";
                 vibDisplay.className = "text-base font-mono text-red-500 font-bold animate-pulse";
            } else if (isJittering) {
                 vibDisplay.innerText = "âš  JITTER (å¾®é¢¤)";
                 vibDisplay.className = "text-base font-mono text-yellow-500 font-bold";
            } else if (isStableTriangle) {
                 vibDisplay.innerText = "STABLE (ç¨³)";
                 vibDisplay.className = "text-base font-mono text-purple-400 font-bold";
            } else {
                 vibDisplay.innerText = "STABLE (ç¨³)";
                 vibDisplay.className = "text-base font-mono text-green-400 font-bold";
            }

            updateScope(camY);
            requestAnimationFrame(animate);
        }

        function updateScope(val) {
            scopeData.shift();
            scopeData.push(val);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            
            if (hardwareState === 'broken' && roadType === 'brick') ctx.strokeStyle = '#ef4444';
            else if (hardwareState === 'broken' && roadType === 'handheld') ctx.strokeStyle = '#eab308'; 
            else if (hardwareState === 'solution') ctx.strokeStyle = '#a78bfa';
            else ctx.strokeStyle = '#4ade80';

            ctx.lineWidth = 3;
            const step = canvas.width / scopeData.length;
            const center = canvas.height / 2;
            scopeData.forEach((v, i) => {
                let y = center + v * 1.5;
                if (i===0) ctx.moveTo(i*step, y);
                else ctx.lineTo(i*step, y);
            });
            ctx.stroke();
        }

        updateStructureVisuals();
        updateUI();
        setTimeout(() => updateLines(0,0), 100);
        animate();

    </script>
</body>
</html>
